<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cargando...</title>
    <meta name="description" content="Ficha del producto">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        brand: 'var(--color-accent)',
                        brand2: 'var(--color-accent2)',
                    },
                    boxShadow: {
                        'soft': '0 20px 40px -15px rgba(0, 0, 0, 0.05)',
                        'glow': '0 0 20px rgba(var(--color-accent-rgb), 0.3)'
                    }
                }
            }
        }
    </script>

    <style>
        /* Variables CSS dinámicas */
        :root {
            --color-accent: #37d67a;
            --color-accent2: #1fbf6a;
        }

        /* FONDO PASTEL / BLANCO */
        body {
            background-color: #ffffff;
            /* Degradado sutil: Arriba un verde menta muy pálido (#f0fdf4), abajo blanco */
            background-image: radial-gradient(circle at 50% 0%, #f0fdf4 0%, #ffffff 60%);
            color: #334155; /* Slate 700 */
            min-height: 100vh;
        }
        
        /* Glassmorphism LIGHT (Vidrio claro) */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);
        }
        
        /* Markdown Styles (Adaptado a fondo claro) */
        .prose strong { color: #0f172a; font-weight: 800; } /* Slate 900 */
        .prose ul { list-style-type: disc; padding-left: 1.5rem; margin: 1rem 0; color: #475569; }
        .prose p { margin-bottom: 1rem; line-height: 1.8; }
        .prose h1, .prose h2 { color: #0f172a; font-weight: 700; margin-bottom: 1rem; }
        
        /* Tabs Animation */
        .tab-content { display: none; animation: fadeIn 0.4s ease-out; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="antialiased opacity-0 transition-opacity duration-700" id="main-body">

    <nav class="fixed w-full z-50 top-0 start-0 border-b border-slate-100 bg-white/80 backdrop-blur-md transition-all">
        <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4" id="nav-container">
            </div>
    </nav>

    <main id="app" class="pt-28 pb-20"></main>

    <footer class="border-t border-slate-100 bg-white py-12">
        <div class="max-w-screen-xl mx-auto px-4 text-center">
            <p id="footer-text" class="text-slate-400 text-sm font-medium"></p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const qs = "?v=" + Date.now();
                const [settingsRes, pageRes] = await Promise.all([
                    fetch('content/settings.json' + qs),
                    fetch('content/page.json' + qs)
                ]);

                if (!settingsRes.ok || !pageRes.ok) throw new Error("Error cargando archivos JSON");

                const settings = await settingsRes.json();
                const page = await pageRes.json();

                applySettings(settings);
                
                const app = document.getElementById('app');
                page.blocks.forEach((block, index) => {
                    if (block.enabled) {
                        const section = document.createElement('section');
                        section.className = "mb-16 md:mb-24"; 
                        section.innerHTML = renderBlock(block, index);
                        app.appendChild(section);
                    }
                });

                document.getElementById('main-body').classList.remove('opacity-0');

            } catch (error) {
                console.error(error);
                document.body.innerHTML = `<div class="flex items-center justify-center h-screen text-red-500 font-bold">Error: ${error.message}</div>`;
                document.getElementById('main-body').classList.remove('opacity-0');
            }
        });

        function applySettings(s) {
            if(s.seoTitle) document.title = s.seoTitle;
            if(s.seoDescription) document.querySelector('meta[name="description"]').setAttribute("content", s.seoDescription);
            
            document.documentElement.style.setProperty('--color-accent', s.accent);
            document.documentElement.style.setProperty('--color-accent2', s.accent2);
            
            // Navbar
            const nav = document.getElementById('nav-container');
            const navLinks = (s.headerNavItems || []).map(i => 
                `<a href="${i.href}" class="block py-2 px-4 text-sm font-semibold text-slate-500 hover:text-brand hover:bg-green-50 rounded-lg transition-all">${i.label}</a>`
            ).join('');

            nav.innerHTML = `
                <a href="#" class="flex items-center gap-3 group">
                    <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-brand text-white font-bold text-xl shadow-lg shadow-green-200 group-hover:scale-105 transition-transform">${s.logoBadge}</span>
                    <span class="self-center text-xl font-bold tracking-tight text-slate-800 group-hover:text-brand transition-colors">${s.brandName}</span>
                </a>
                <div class="hidden md:block">
                    <ul class="flex space-x-1">
                        ${navLinks}
                    </ul>
                </div>
            `;

            document.getElementById('footer-text').innerText = s.footerText;
        }

        function renderBlock(block, index) {
            const idAttr = block.id ? `id="${block.id}"` : '';
            const containerClass = "max-w-screen-xl mx-auto px-4 md:px-8";

            switch(block.type) {
                case 'hero':
                    const buttons = (block.buttons || []).map(btn => {
                        const base = "px-8 py-4 rounded-full font-bold transition-all duration-300 inline-block text-sm tracking-wide shadow-sm";
                        // Primary: Brand color | Secondary: White with border
                        return btn.variant === 'primary' 
                            ? `<a href="${btn.href}" class="${base} bg-brand hover:bg-brand2 text-white shadow-lg shadow-green-200 hover:shadow-green-300 transform hover:-translate-y-1">${btn.label}</a>`
                            : `<a href="${btn.href}" class="${base} bg-white border border-slate-200 text-slate-600 hover:text-brand hover:border-brand hover:bg-green-50">${btn.label}</a>`;
                    }).join(' ');

                    const pills = (block.pills || []).map(p => 
                        // Pills estilo pastel: Fondo verde muy suave, texto verde oscuro
                        `<span class="bg-green-50 text-emerald-700 text-[11px] font-bold px-3 py-1.5 rounded-full uppercase tracking-widest border border-green-100">${p}</span>`
                    ).join('');

                    return `
                        <div ${idAttr} class="${containerClass} grid md:grid-cols-2 gap-12 md:gap-20 items-center">
                            <div class="space-y-8 order-2 md:order-1">
                                <div class="flex gap-2 flex-wrap">${pills}</div>
                                <div class="space-y-4">
                                    <h2 class="text-brand font-extrabold tracking-widest uppercase text-xs bg-green-50 inline-block px-2 py-1 rounded">${block.subtitle || ''}</h2>
                                    <h1 class="text-5xl md:text-7xl font-black tracking-tight text-slate-900 leading-[1.05]">
                                        ${block.title}
                                    </h1>
                                    <p class="text-lg md:text-xl text-slate-500 font-medium leading-relaxed max-w-lg">
                                        ${marked.parse(block.body || '')}
                                    </p>
                                </div>
                                <div class="flex flex-wrap gap-4 pt-2">${buttons}</div>
                            </div>
                            <div class="relative group order-1 md:order-2">
                                <div class="absolute -inset-4 bg-green-200 rounded-[2.5rem] blur-2xl opacity-40 group-hover:opacity-60 transition duration-1000 transform rotate-3"></div>
                                <div class="relative rounded-[2rem] overflow-hidden bg-white shadow-2xl shadow-slate-200 border border-white">
                                    <img src="${block.image}" alt="${block.imageAlt}" class="w-full h-auto object-cover transform group-hover:scale-105 transition duration-700">
                                </div>
                            </div>
                        </div>
                    `;

                case 'text':
                    return `
                        <div ${idAttr} class="${containerClass}">
                            <div class="bg-white rounded-[2rem] p-8 md:p-16 max-w-4xl mx-auto shadow-xl shadow-slate-100 border border-slate-50">
                                <h2 class="text-3xl font-bold mb-6 text-slate-900 border-l-4 border-brand pl-6">${block.title}</h2>
                                <div class="prose prose-lg text-slate-600 prose-headings:text-slate-800 prose-strong:text-brand">
                                    ${marked.parse(block.body || '')}
                                </div>
                            </div>
                        </div>
                    `;

                case 'tabs':
                    const tabHeaders = block.tabs.map((t, idx) => 
                        `<button onclick="switchTab('${block.id}', ${idx})" 
                            class="tab-btn px-6 py-4 text-sm font-bold uppercase tracking-wider transition-all border-b-2 ${idx === 0 ? 'border-brand text-brand bg-green-50/50' : 'border-transparent text-slate-400 hover:text-slate-600 hover:bg-slate-50'}" 
                            data-idx="${idx}">
                            ${t.label}
                        </button>`
                    ).join('');

                    const tabBodies = block.tabs.map((t, idx) => 
                        `<div class="tab-content prose text-slate-600 ${idx === 0 ? 'active' : ''}" data-idx="${idx}">
                            ${marked.parse(t.body || '')}
                        </div>`
                    ).join('');

                    return `
                        <div ${idAttr} class="${containerClass}">
                            <div class="bg-white rounded-[2rem] overflow-hidden shadow-xl shadow-slate-100 border border-slate-100">
                                <div class="border-b border-slate-100 flex overflow-x-auto">
                                    ${tabHeaders}
                                </div>
                                <div class="p-8 md:p-16 min-h-[300px]">
                                    ${tabBodies}
                                </div>
                            </div>
                        </div>
                    `;

                case 'gallery':
                    const imgs = (block.images || []).map(img => 
                        `<div class="group relative overflow-hidden rounded-2xl bg-slate-100 aspect-square border border-slate-100 shadow-sm hover:shadow-xl hover:shadow-green-100 transition-all duration-500">
                            <div class="absolute inset-0 bg-brand/10 opacity-0 group-hover:opacity-100 transition-opacity z-10"></div>
                            <img src="${img.image}" alt="${img.alt}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                        </div>`
                    ).join('');
                    
                    return `
                        <div ${idAttr} class="${containerClass}">
                            <h2 class="text-3xl font-black mb-12 text-center text-slate-900 tracking-tight">${block.title}</h2>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-6 md:gap-8">
                                ${imgs}
                            </div>
                        </div>
                    `;

                default: return '';
            }
        }

        window.switchTab = (sectionId, index) => {
            const container = document.getElementById(sectionId);
            if(!container) return;
            
            container.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.remove('border-brand', 'text-brand', 'bg-green-50/50');
                b.classList.add('border-transparent', 'text-slate-400');
            });
            const activeBtn = container.querySelector(`.tab-btn[data-idx="${index}"]`);
            activeBtn.classList.remove('border-transparent', 'text-slate-400');
            activeBtn.classList.add('border-brand', 'text-brand', 'bg-green-50/50');

            container.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            container.querySelector(`.tab-content[data-idx="${index}"]`).classList.add('active');
        };
    </script>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
        if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", (user) => {
                const hash = window.location.hash || "";
                if (!user && (hash.includes("invite_token=") || hash.includes("recovery_token="))) { window.netlifyIdentity.open(); }
            });
            window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; });
        }
    </script>
</body>
</html>