<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#f6fbf7" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#0f1512" media="(prefers-color-scheme: dark)">

  <title>Spirulina Â· Ficha del Producto</title>
  <meta name="description" content="Ficha editable: descripciÃ³n, informaciÃ³n nutricional y modo de uso." />

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    :root{
      /* âœ… LIGHT FIRST */
      --bg:#f6fbf7;
      --card:#ffffff;
      --border: rgba(10, 30, 18, .10);
      --text: rgba(14, 22, 18, .92);
      --muted: rgba(50, 74, 60, .78);
      --shadow: 0 10px 28px rgba(0,0,0,.08);
      --radius: 16px;
      --container: 1100px;

      /* ðŸŒ¿ Verde */
      --accent:#22c55e;
      --accent-2:#16a34a;
      --accent-soft: rgba(34,197,94,.12);

      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0b120f;
        --card: rgba(255,255,255,.06);
        --border: rgba(255,255,255,.12);
        --text: rgba(235,245,238,.92);
        --muted: rgba(190,215,198,.78);
        --shadow: 0 18px 60px rgba(0,0,0,.35);
        --accent-soft: rgba(34,197,94,.16);
      }
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      background: var(--bg);
      line-height: 1.5;
    }

    a{ color: inherit; text-decoration:none; }
    .container{ width:min(var(--container), calc(100% - 32px)); margin:0 auto; }

    /* Header */
    header{
      position: sticky;
      top: 0;
      z-index: 10;
      background: color-mix(in oklab, var(--bg) 88%, transparent);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
    }
    .header-inner{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 12px 0;
    }
    .brand{
      display:flex;
      align-items:center;
      gap: 10px;
      font-weight: 900;
      letter-spacing: .02em;
      min-width: 170px;
    }
    .badge{
      width: 34px;
      height: 34px;
      border-radius: 12px;
      display:grid;
      place-items:center;
      background: var(--accent-soft);
      border: 1px solid color-mix(in oklab, var(--accent) 24%, transparent);
      color: color-mix(in oklab, var(--accent) 55%, var(--text));
    }

    .nav{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .nav a{
      padding: 8px 10px;
      border-radius: 12px;
      color: var(--muted);
      font-weight: 800;
    }
    .nav a:hover{ background: var(--accent-soft); color: var(--text); }

    .btn{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      font-weight: 900;
      cursor: pointer;
      transition: transform .12s ease;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:active{ transform: scale(.98); }

    .btn.primary{
      background: var(--accent);
      border-color: color-mix(in oklab, var(--accent) 35%, var(--border));
      color: white;
    }
    .btn.primary:hover{ filter: brightness(.98); }

    @media (max-width: 820px){
      .nav{ display:none; }
    }

    /* Layout */
    main{ padding: 22px 0 44px; }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    /* Hero */
    .hero{
      display:grid;
      grid-template-columns: 1fr 1.2fr;
      gap: 18px;
      padding: 18px;
      align-items: center;
    }
    @media (max-width: 920px){
      .hero{ grid-template-columns: 1fr; }
    }

    .media{
      border-radius: calc(var(--radius) - 2px);
      border: 1px solid color-mix(in oklab, var(--accent) 22%, var(--border));
      background: linear-gradient(135deg, var(--accent-soft), transparent);
      padding: 16px;
      display:grid;
      place-items:center;
      min-height: 240px;
    }
    .media img{
      width: min(380px, 100%);
      height:auto;
      display:block;
    }

    .kicker{
      margin:0;
      font-size: 12px;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: var(--muted);
      font-weight: 900;
    }
    h1{
      margin: 6px 0 8px;
      font-size: clamp(26px, 3vw, 38px);
      line-height: 1.1;
    }
    .hero-headline{
      font-weight: 900;
      margin: 6px 0 8px;
    }
    .lead{ color: var(--muted); font-size: 15.5px; }

    .pills{ display:flex; flex-wrap:wrap; gap: 10px; margin: 12px 0 0; }
    .pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 7px 10px;
      border-radius: 999px;
      background: var(--accent-soft);
      border: 1px solid color-mix(in oklab, var(--accent) 22%, transparent);
      font-weight: 900;
      color: color-mix(in oklab, var(--accent) 55%, var(--text));
      font-size: 13px;
    }

    .actions{ display:flex; gap: 10px; flex-wrap:wrap; margin-top: 12px; }

    /* Blocks */
    section.block{ padding: 18px 0; }
    .block-title{ margin: 0 0 10px; font-size: 20px; }

    .content{ padding: 18px; }

    .md{ color: var(--muted); line-height: 1.75; font-size: 15.5px; }
    .md p{ margin: 10px 0; }
    .md ul, .md ol{ margin: 10px 0; padding-left: 18px; }
    .md li{ margin: 6px 0; }
    .md img{
      max-width:100%;
      height:auto;
      border-radius: 14px;
      border: 1px solid var(--border);
      display:block;
    }

    /* Nav chips block */
    .navchips{ display:flex; flex-wrap:wrap; gap:10px; padding:16px 18px; }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px; border-radius:999px;
      background: var(--accent-soft);
      border: 1px solid color-mix(in oklab, var(--accent) 22%, transparent);
      font-weight: 900;
      color: color-mix(in oklab, var(--accent) 55%, var(--text));
    }
    .chip:hover{ filter: brightness(.98); }

    /* Image block */
    .figure{ padding:16px 18px; display:grid; gap:10px; }
    .figure img{ width:100%; height:auto; display:block; border-radius:14px; border:1px solid var(--border); }
    .caption{ color: var(--muted); font-size:13px; line-height:1.5; }

    /* Gallery */
    .grid{ display:grid; grid-template-columns:repeat(3, 1fr); gap:12px; padding:16px 18px; }
    .grid img{ width:100%; height:auto; display:block; border-radius:14px; border:1px solid var(--border); }
    @media (max-width: 900px){ .grid{ grid-template-columns:repeat(2, 1fr);} }
    @media (max-width: 560px){ .grid{ grid-template-columns:1fr;} }

    /* Tabs */
    .tabs{ border-top: 1px solid var(--border); }
    .tabbar{
      display:flex;
      gap: 8px;
      padding: 12px;
      overflow-x:auto;
      scrollbar-width:none;
      border-bottom: 1px solid var(--border);
      background: color-mix(in oklab, var(--card) 88%, transparent);
    }
    .tabbar::-webkit-scrollbar{ display:none; }

    .tab{
      white-space: nowrap;
      border: 1px solid transparent;
      background: transparent;
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 900;
      color: var(--muted);
      cursor:pointer;
    }
    .tab[aria-selected="true"]{
      color: var(--text);
      background: var(--accent-soft);
      border-color: color-mix(in oklab, var(--accent) 22%, transparent);
    }
    .panel{ display:none; padding: 16px 18px; }
    .panel.active{ display:block; }

    /* Footer */
    footer{
      border-top: 1px solid var(--border);
      padding: 18px 0;
      color: var(--muted);
      font-weight: 800;
      font-size: 14px;
    }

    /* A11y */
    :focus-visible{ outline: 3px solid color-mix(in oklab, var(--accent) 55%, transparent); outline-offset: 3px; }
  </style>
</head>

<body>
  <header>
    <div class="container header-inner">
      <a class="brand" href="#top" aria-label="Inicio">
        <span class="badge" id="logoBadge">S</span>
        <span id="brandName">Spirulina</span>
      </a>

      <nav class="nav" id="headerNav" aria-label="Principal"></nav>

      <button class="btn" id="themeToggle" type="button" aria-label="Cambiar tema">
        <span aria-hidden="true">ðŸŒ“</span>
        <span>Tema</span>
      </button>
    </div>
  </header>

  <main id="top">
    <div class="container" id="blocks"></div>
  </main>

  <footer>
    <div class="container" style="display:flex;justify-content:space-between;gap:12px;align-items:center;flex-wrap:wrap;">
      <span id="footerText">Â© 2026. Todos los derechos reservados.</span>
      <a class="btn" href="#top" aria-label="Volver arriba">â†‘ Arriba</a>
    </div>
  </footer>

  <script>
    const $ = (s, r=document) => r.querySelector(s);

    // âœ… Fallback (solo si falla fetch). En producciÃ³n manda content/settings.json y content/page.json
    const DEFAULT_SETTINGS = {
      seoTitle: "Spirulina Â· Ficha del Producto",
      seoDescription: "PÃ¡gina editable (sin cÃ³digo): textos, imÃ¡genes, tabs, colores y tipografÃ­as.",
      brandName: "Spirulina",
      logoBadge: "S",
      defaultTheme: "light",
      accent: "#22c55e",
      accent2: "#16a34a",
      containerWidth: 1100,
      font: "ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial",
      headerNavItems: [
        { label: "Producto", href: "#producto" },
        { label: "Beneficios", href: "#beneficios" },
        { label: "InformaciÃ³n", href: "#info" }
      ],
      footerText: "Â© 2026. Todos los derechos reservados."
    };

    const DEFAULT_PAGE = {
      blocks: [
        {
          type: "hero",
          enabled: true,
          id: "producto",
          title: "Spirulina",
          subtitle: "Contenido de ejemplo (edÃ­tame en el CMS)",
          headline: "Este texto es inventado para que el editor sepa quÃ© cambiar.",
          body: "âœ… AquÃ­ puedes escribir una **introducciÃ³n**.\n\n- Listas\n- Negritas\n- PÃ¡rrafos\n\n**Tip:** reemplaza este texto por tu descripciÃ³n real.",
          image: "assets/uploads/demo-product.svg",
          imageAlt: "Producto",
          pills: ["ðŸŒ¿ Natural", "ðŸ¥¤ FÃ¡cil de mezclar", "âœ¨ Rutina diaria"],
          buttons: [
            { label: "Ver informaciÃ³n", href: "#info", variant: "primary" },
            { label: "Ir a beneficios", href: "#beneficios", variant: "ghost" }
          ]
        },
        {
          type: "nav",
          enabled: true,
          id: "navegacion",
          items: [
            { label: "ðŸ“Œ Producto", href: "#producto" },
            { label: "ðŸ’š Beneficios", href: "#beneficios" },
            { label: "ðŸ“‹ Tabs", href: "#info" }
          ]
        },
        {
          type: "text",
          enabled: true,
          id: "beneficios",
          title: "Beneficios (demo)",
          body: "Este bloque es solo un **ejemplo**.\n\n- âœ… Beneficio 1\n- âœ… Beneficio 2\n- âœ… Beneficio 3"
        },
        {
          type: "image",
          enabled: true,
          id: "imagen",
          title: "Bloque de imagen (demo)",
          image: "assets/uploads/demo-1.svg",
          alt: "Imagen demo",
          caption: "Caption demo: aquÃ­ puedes explicar la foto o dar una nota."
        },
        {
          type: "gallery",
          enabled: true,
          id: "galeria",
          title: "GalerÃ­a (demo)",
          images: [
            { image: "assets/uploads/demo-2.svg", alt: "Demo 2" },
            { image: "assets/uploads/demo-3.svg", alt: "Demo 3" },
            { image: "assets/uploads/demo-1.svg", alt: "Demo 1" }
          ]
        },
        {
          type: "tabs",
          enabled: true,
          id: "info",
          title: "InformaciÃ³n del producto (demo)",
          ariaLabel: "Tabs de producto",
          tabs: [
            { label: "DescripciÃ³n", body: "Contenido inventado para **DescripciÃ³n**." },
            { label: "InformaciÃ³n nutricional", body: "Ejemplo (reemplazar con etiqueta real)." },
            { label: "Modo de uso", body: "1) Mezcla 1 cucharadita\n2) En 250ml\n3) Ajusta al gusto" }
          ]
        }
      ]
    };

    function mdToHtml(md){
      const s = (md ?? "").toString();
      if (window.marked) return marked.parse(s);
      return s
        .replace(/[&<>]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[m]))
        .replace(/\n/g, "<br>");
    }

    function normalizePath(p){
      if (!p) return p;
      if (location.protocol === "file:" && p.startsWith("/")) return p.slice(1);
      return p;
    }

    function fallbackImg(img){
      img.onerror = () => {
        img.onerror = null;
        const svg = encodeURIComponent(`
          <svg xmlns="http://www.w3.org/2000/svg" width="900" height="700">
            <defs>
              <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="rgba(34,197,94,0.20)"/>
                <stop offset="1" stop-color="rgba(22,163,74,0.08)"/>
              </linearGradient>
            </defs>
            <rect width="100%" height="100%" fill="url(#g)"/>
            <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle"
              font-family="Arial" font-size="34" fill="rgba(20,60,35,0.85)">Imagen no encontrada</text>
          </svg>
        `);
        img.src = "data:image/svg+xml;charset=utf-8," + svg;
      };
    }

    function setThemeVars(mode){
      const r = document.documentElement.style;
      if (mode === "dark"){
        r.setProperty("--bg", "#0b120f");
        r.setProperty("--card", "rgba(255,255,255,.06)");
        r.setProperty("--border", "rgba(255,255,255,.12)");
        r.setProperty("--text", "rgba(235,245,238,.92)");
        r.setProperty("--muted", "rgba(190,215,198,.78)");
        r.setProperty("--shadow", "0 18px 60px rgba(0,0,0,.35)");
        r.setProperty("--accent-soft", "rgba(34,197,94,.16)");
      } else {
        r.setProperty("--bg", "#f6fbf7");
        r.setProperty("--card", "#ffffff");
        r.setProperty("--border", "rgba(10, 30, 18, .10)");
        r.setProperty("--text", "rgba(14, 22, 18, .92)");
        r.setProperty("--muted", "rgba(50, 74, 60, .78)");
        r.setProperty("--shadow", "0 10px 28px rgba(0,0,0,.08)");
        r.setProperty("--accent-soft", "rgba(34,197,94,.12)");
      }
    }

    function applySettings(s){
      if (s.seoTitle) document.title = s.seoTitle;
      const metaDesc = document.querySelector('meta[name="description"]');
      if (metaDesc && s.seoDescription) metaDesc.setAttribute("content", s.seoDescription);

      $("#brandName").textContent = s.brandName || "Spirulina";
      $("#logoBadge").textContent = (s.logoBadge || "S").slice(0,2);
      $("#footerText").textContent = s.footerText || "Â© 2026. Todos los derechos reservados.";

      const r = document.documentElement.style;
      if (s.accent) r.setProperty("--accent", s.accent);
      if (s.accent2) r.setProperty("--accent-2", s.accent2);
      if (s.containerWidth) r.setProperty("--container", s.containerWidth + "px");
      if (s.font) r.setProperty("--font", s.font);

      const nav = $("#headerNav");
      nav.innerHTML = "";
      (s.headerNavItems || []).forEach(item => {
        const a = document.createElement("a");
        a.href = item.href || "#top";
        a.textContent = item.label || "Link";
        nav.appendChild(a);
      });

      const root = document.documentElement;
      const saved = localStorage.getItem("theme");
      const initial = saved || s.defaultTheme || "light";
      root.dataset.theme = initial;
      setThemeVars(initial);
    }

    function renderHero(block){
      const wrap = document.createElement("section");
      wrap.className = "card";
      wrap.id = block.id || "producto";

      const kicker = (block.subtitle || block.kicker || "").toString();
      const headline = (block.headline || "").toString();

      wrap.innerHTML = `
        <div class="hero">
          <div class="media">
            <img alt="${(block.imageAlt||"Producto").toString()}" />
          </div>
          <div>
            ${kicker ? `<p class="kicker">${kicker}</p>` : ""}
            <h1>${(block.title||"").toString()}</h1>
            ${headline ? `<div class="hero-headline">${headline}</div>` : ""}
            <div class="md lead">${mdToHtml(block.body||"")}</div>

            <div class="pills"></div>
            <div class="actions"></div>
          </div>
        </div>
      `;

      const img = wrap.querySelector("img");
      img.src = normalizePath(block.image || "");
      fallbackImg(img);

      const pills = wrap.querySelector(".pills");
      (block.pills || []).forEach(p => {
        const s = document.createElement("span");
        s.className = "pill";
        s.textContent = p;
        pills.appendChild(s);
      });

      const actions = wrap.querySelector(".actions");
      (block.buttons || []).forEach(b => {
        const a = document.createElement("a");
        a.className = "btn " + (b.variant === "primary" ? "primary" : "");
        a.href = b.href || "#top";
        a.textContent = b.label || "Ver";
        actions.appendChild(a);
      });

      return wrap;
    }

    function renderNav(block){
      const section = document.createElement("section");
      section.className = "block";
      section.id = block.id || "";

      section.innerHTML = `
        <div class="card">
          <div class="navchips"></div>
        </div>
      `;

      const nav = section.querySelector(".navchips");
      (block.items || []).forEach(it => {
        const a = document.createElement("a");
        a.className = "chip";
        a.href = it.href || "#top";
        a.textContent = it.label || "Ir";
        nav.appendChild(a);
      });

      return section;
    }

    function renderText(block){
      const section = document.createElement("section");
      section.className = "block";
      section.id = block.id || "";
      section.innerHTML = `
        <div class="card">
          <div class="content">
            ${block.title ? `<h2 class="block-title">${block.title}</h2>` : ""}
            <div class="md">${mdToHtml(block.body||"")}</div>
          </div>
        </div>
      `;
      return section;
    }

    function renderImage(block){
      const section = document.createElement("section");
      section.className = "block";
      section.id = block.id || "";

      section.innerHTML = `
        <div class="card">
          <div class="figure">
            ${block.title ? `<h2 class="block-title" style="margin:0;">${block.title}</h2>` : ""}
            <img alt="${(block.alt || "").toString()}" />
            ${block.caption ? `<div class="caption">${block.caption}</div>` : ""}
          </div>
        </div>
      `;

      const img = section.querySelector("img");
      img.src = normalizePath(block.image || "");
      fallbackImg(img);

      return section;
    }

    function renderGallery(block){
      const section = document.createElement("section");
      section.className = "block";
      section.id = block.id || "";

      section.innerHTML = `
        ${block.title ? `<h2 class="block-title" style="margin:0 0 10px;">${block.title}</h2>` : ""}
        <div class="card">
          <div class="grid"></div>
        </div>
      `;

      const grid = section.querySelector(".grid");
      (block.images || []).forEach(it => {
        const img = document.createElement("img");
        img.alt = (it.alt || "").toString();
        img.src = normalizePath(it.image || "");
        fallbackImg(img);
        grid.appendChild(img);
      });

      return section;
    }

    function renderTabs(block, idx){
      const section = document.createElement("section");
      section.className = "block";
      section.id = block.id || "";

      const uid = `tabs-${idx}`;
      section.innerHTML = `
        ${block.title ? `<h2 class="block-title" style="margin:0 0 10px;">${block.title}</h2>` : ""}
        <div class="card tabs" data-tabs="${uid}">
          <div class="tabbar" role="tablist" aria-label="${(block.ariaLabel || "InformaciÃ³n").toString()}"></div>
          <div class="panels"></div>
        </div>
      `;

      const shell = section.querySelector(`[data-tabs="${uid}"]`);
      const tabbar = shell.querySelector(".tabbar");
      const panels = shell.querySelector(".panels");

      const tabs = block.tabs || [];
      tabs.forEach((t, i) => {
        const btn = document.createElement("button");
        btn.className = "tab";
        btn.type = "button";
        btn.role = "tab";
        btn.id = `${uid}-tab-${i}`;
        btn.setAttribute("aria-selected", i === 0 ? "true" : "false");
        btn.setAttribute("aria-controls", `${uid}-panel-${i}`);
        btn.textContent = t.label || `Tab ${i+1}`;
        tabbar.appendChild(btn);

        const panel = document.createElement("div");
        panel.className = "panel" + (i === 0 ? " active" : "");
        panel.id = `${uid}-panel-${i}`;
        panel.role = "tabpanel";
        panel.setAttribute("aria-labelledby", btn.id);
        panel.innerHTML = `<div class="md">${mdToHtml(t.body || "")}</div>`;
        panels.appendChild(panel);
      });

      tabbar.addEventListener("click", (e) => {
        const btn = e.target.closest(".tab");
        if (!btn) return;
        const all = Array.from(tabbar.querySelectorAll(".tab"));
        const i = all.indexOf(btn);
        all.forEach(b => b.setAttribute("aria-selected", String(b === btn)));
        Array.from(panels.children).forEach((p, pi) => p.classList.toggle("active", pi === i));
      });

      return section;
    }

    function renderBlocks(page){
      const root = $("#blocks");
      root.innerHTML = "";

      (page.blocks || []).forEach((b, i) => {
        if (b.enabled === false) return; // âœ… ocultar desde CMS

        const wrap = document.createElement("div");

        if (b.type === "hero") wrap.appendChild(renderHero(b));
        else if (b.type === "nav") wrap.appendChild(renderNav(b));
        else if (b.type === "text") wrap.appendChild(renderText(b));
        else if (b.type === "image") wrap.appendChild(renderImage(b));
        else if (b.type === "gallery") wrap.appendChild(renderGallery(b));
        else if (b.type === "tabs") wrap.appendChild(renderTabs(b, i));
        else return;

        if (b.type !== "hero") wrap.className = "block";
        root.appendChild(wrap);
      });
    }

    function initThemeToggle(){
      const btn = $("#themeToggle");
      const root = document.documentElement;
      btn.addEventListener("click", () => {
        const next = root.dataset.theme === "dark" ? "light" : "dark";
        root.dataset.theme = next;
        localStorage.setItem("theme", next);
        setThemeVars(next);
      });
    }

    (async function(){
      initThemeToggle();

      let settings = DEFAULT_SETTINGS;
      let page = DEFAULT_PAGE;

      try{
        const qs = "?v=" + Date.now();
        const [settingsRes, pageRes] = await Promise.all([
          fetch("content/settings.json" + qs),
          fetch("content/page.json" + qs),
        ]);
        if (!settingsRes.ok || !pageRes.ok) throw new Error("No se pudieron cargar los JSON.");
        settings = await settingsRes.json();
        page = await pageRes.json();
      }catch(e){
        console.warn("Usando DEMO por error de carga:", e);
      }

      applySettings(settings);
      renderBlocks(page);
    })();
  </script>

  <!-- Netlify Identity widget (NECESARIO para /admin y para aceptar invitaciones) -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script>
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", (user) => {
        const hash = window.location.hash || "";
        const hasInvite = hash.includes("invite_token=") || hash.includes("recovery_token=");
        if (!user && hasInvite) window.netlifyIdentity.open();
      });
      window.netlifyIdentity.on("login", () => {
        document.location.href = "/admin/";
      });
    }
  </script>
</body>
</html>
